{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    .app-section {
        margin-bottom: 2em;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 1em;
    }
    .model-card {
        margin-bottom: 1em;
        background-color: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 1em;
    }
    .field-list {
        margin-left: 1em;
    }
    .field-item {
        border-bottom: 1px solid #eee;
        padding: 8px;
        display: flex;
    }
    .field-name {
        font-weight: bold;
        flex: 0 0 150px;
    }
    .field-type {
        color: #28a745;
        flex: 0 0 120px;
    }
    .field-attrs {
        color: #6c757d;
        flex: 1;
    }
    .url-list {
        list-style-type: none;
        padding-left: 0;
    }
    .url-item {
        border-bottom: 1px solid #eee;
        padding: 8px;
    }
    .app-filter {
        margin-bottom: 1em;
    }
    .json-link {
        float: right;
        margin-top: 1em;
    }
</style>
{% endblock %}

{% block content %}
<div class="app-section">
    <h1>Django AI Tools Dashboard</h1>
    <p>This dashboard shows the structure of your Django models and URL patterns. 
       It can be used by AI tools to understand your project structure.</p>
    
    <div class="app-filter">
        <h2>Filter by App</h2>
        <form method="get" action="">
            <select name="app">
                <option value="">All Apps</option>
                {% for app in available_apps %}
                <option value="{{ app }}" {% if app_name == app %}selected{% endif %}>{{ app }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="button">Filter</button>
        </form>
        <a href="?{% if app_name %}app={{ app_name }}&{% endif %}format=json" class="json-link">View as JSON</a>
    </div>
</div>

<div class="app-section">
    <h2>Models</h2>
    
    {% for app_label, models in model_data.items %}
        <h3>{{ app_label }}</h3>
        
        {% for model_name, model_info in models.items %}
            <div class="model-card">
                <h4>{{ model_name }}</h4>
                <p>{{ model_info.verbose_name_plural }} ({{ model_info.verbose_name }})</p>
                
                <h5>Fields:</h5>
                <div class="field-list">
                    {% for field_name, field_info in model_info.fields.items %}
                        <div class="field-item">
                            <span class="field-name">{{ field_name }}</span>
                            <span class="field-type">{{ field_info.type }}</span>
                            <span class="field-attrs">
                                {% if field_info.nullable %}nullable{% else %}not null{% endif %}
                                {% if field_info.relates_to %}
                                    | relates to {{ field_info.relates_to.model }} ({{ field_info.relates_to.app }})
                                    {% if field_info.relates_to.type %} ({{ field_info.relates_to.type }}){% endif %}
                                {% endif %}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% empty %}
            <p>No models found for this app.</p>
        {% endfor %}
    {% empty %}
        <p>No models found.</p>
    {% endfor %}
</div>

<div class="app-section">
    <h2>URL Patterns</h2>
    <ul class="url-list">
        {% for url in url_patterns.url_patterns %}
            <li class="url-item">
                <strong>{{ url.path }}</strong>
                <div>View: {{ url.module }}.{{ url.view }}</div>
                {% if url.name %}<div>Name: {{ url.name }}</div>{% endif %}
            </li>
        {% empty %}
            <li>No URL patterns found.</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}